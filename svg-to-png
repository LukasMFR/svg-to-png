#!/bin/bash

# Default values for parameters
default_height=3200
set_dpi=false
dpi=600

# Function to display help menu
show_help() {
    echo "Usage: $0 -f FILENAME [-h HEIGHT] [--set-dpi]"
    echo ""
    echo "Convert SVG to PNG using rsvg-convert."
    echo ""
    echo "   -h, --help            Display this help menu and exit"
    echo "   -f, --file FILENAME   Specify the SVG file to convert"
    echo "   -h, --height HEIGHT   Optional: Specify the height (default is $default_height)"
    echo "   --set-dpi             Optional: Set the DPI to 600 in the PNG file"
    echo ""
}

# Parse command-line options
while [[ $# -gt 0 ]]; do
    case $1 in
        -h|--help)
            show_help
            exit 0
            ;;
        -f|--file)
            filename="${2%.*}"
            shift # past argument
            shift # past value
            ;;
        -h|--height)
            height="$2"
            shift # past argument
            shift # past value
            ;;
        --set-dpi)
            set_dpi=true
            shift # past argument
            ;;
        *)    # unknown option
            show_help >&2
            exit 1
            ;;
    esac
done

# Check required file parameter
if [ -z "${filename}" ]; then
    echo "Error: No file specified."
    show_help >&2
    exit 1
fi

# Check if the file exists
if [ ! -f "${filename}.svg" ]; then
    echo "Error: File ${filename}.svg not found."
    exit 1
fi

# Use default height if not specified
if [ -z "$height" ]; then
    height=$default_height
fi

# Convert SVG to PNG using rsvg-convert with the specified height
rsvg-convert -h "$height" "${filename}.svg" > "${filename}.png"
echo "SVG conversion complete: ${filename}.png"

# Optionally set the DPI using ImageMagick
if [ "$set_dpi" = true ]; then
    convert "${filename}.png" -units PixelsPerInch -density $dpi "${filename}.png"
    echo "DPI set to $dpi for ${filename}.png"
fi